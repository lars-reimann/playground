var input = {"type":"node","value":"catalog","children":[{"type":"node","value":"book","children":[{"type":"node","value":"author","children":[{"type":"leaf","value":"Gambardella, Matthew","children":[]}]},{"type":"node","value":"title","children":[{"type":"leaf","value":"XML Developer's Guide","children":[]}]},{"type":"node","value":"genre","children":[{"type":"leaf","value":"Computer","children":[]}]},{"type":"node","value":"price","children":[{"type":"leaf","value":"44.95","children":[]}]},{"type":"node","value":"publish_date","children":[{"type":"leaf","value":"2000-10-01","children":[]}]},{"type":"node","value":"description","children":[{"type":"leaf","value":"An","children":[]},{"type":"node","value":"strong","children":[{"type":"leaf","value":"in-depth","children":[]}]},{"type":"leaf","value":"look at creating applications \n      with XML.","children":[]}]}]},{"type":"node","value":"book","children":[{"type":"node","value":"author","children":[{"type":"leaf","value":"Ralls, Kim","children":[]}]},{"type":"node","value":"title","children":[{"type":"leaf","value":"Midnight Rain","children":[]}]},{"type":"node","value":"genre","children":[{"type":"leaf","value":"Fantasy","children":[]}]},{"type":"node","value":"price","children":[{"type":"leaf","value":"5.95","children":[]}]},{"type":"node","value":"publish_date","children":[{"type":"leaf","value":"2000-12-16","children":[]}]},{"type":"node","value":"description","children":[{"type":"leaf","value":"A former architect battles corporate zombies, \n      an evil sorceress, and her own childhood to become queen \n      of the world.","children":[]}]}]},{"type":"node","value":"book","children":[{"type":"node","value":"author","children":[{"type":"leaf","value":"Corets, Eva","children":[]}]},{"type":"node","value":"title","children":[{"type":"leaf","value":"Maeve Ascendant","children":[]}]},{"type":"node","value":"genre","children":[{"type":"leaf","value":"Fantasy","children":[]}]},{"type":"node","value":"price","children":[{"type":"leaf","value":"5.95","children":[]}]},{"type":"node","value":"publish_date","children":[{"type":"leaf","value":"2000-11-17","children":[]}]},{"type":"node","value":"description","children":[{"type":"leaf","value":"After the collapse of a nanotechnology \n      society in England, the young survivors lay the \n      foundation for a new society.","children":[]}]}]},{"type":"node","value":"book","children":[{"type":"node","value":"author","children":[{"type":"leaf","value":"Corets, Eva","children":[]}]},{"type":"node","value":"title","children":[{"type":"leaf","value":"Oberon's Legacy","children":[]}]},{"type":"node","value":"genre","children":[{"type":"leaf","value":"Fantasy","children":[]}]},{"type":"node","value":"price","children":[{"type":"leaf","value":"5.95","children":[]}]},{"type":"node","value":"publish_date","children":[{"type":"leaf","value":"2001-03-10","children":[]}]},{"type":"node","value":"description","children":[{"type":"leaf","value":"In post-apocalypse England, the mysterious \n      agent known only as Oberon helps to create a new life \n      for the inhabitants of London. Sequel to Maeve \n      Ascendant.","children":[]}]}]},{"type":"node","value":"book","children":[{"type":"node","value":"author","children":[{"type":"leaf","value":"Corets, Eva","children":[]}]},{"type":"node","value":"title","children":[{"type":"leaf","value":"The Sundered Grail","children":[]}]},{"type":"node","value":"genre","children":[{"type":"leaf","value":"Fantasy","children":[]}]},{"type":"node","value":"price","children":[{"type":"leaf","value":"5.95","children":[]}]},{"type":"node","value":"publish_date","children":[{"type":"leaf","value":"2001-09-10","children":[]}]},{"type":"node","value":"description","children":[{"type":"leaf","value":"The two daughters of Maeve, half-sisters, \n      battle one another for control of England. Sequel to \n      Oberon's Legacy.","children":[]}]}]},{"type":"node","value":"book","children":[{"type":"node","value":"author","children":[{"type":"leaf","value":"Randall, Cynthia","children":[]}]},{"type":"node","value":"title","children":[{"type":"leaf","value":"Lover Birds","children":[]}]},{"type":"node","value":"genre","children":[{"type":"leaf","value":"Romance","children":[]}]},{"type":"node","value":"price","children":[{"type":"leaf","value":"4.95","children":[]}]},{"type":"node","value":"publish_date","children":[{"type":"leaf","value":"2000-09-02","children":[]}]},{"type":"node","value":"description","children":[{"type":"leaf","value":"When Carla meets Paul at an ornithology \n      conference, tempers fly as feathers get ruffled.","children":[]}]}]},{"type":"node","value":"book","children":[{"type":"node","value":"author","children":[{"type":"leaf","value":"Thurman, Paula","children":[]}]},{"type":"node","value":"title","children":[{"type":"leaf","value":"Splish Splash","children":[]}]},{"type":"node","value":"genre","children":[{"type":"leaf","value":"Romance","children":[]}]},{"type":"node","value":"price","children":[{"type":"leaf","value":"4.95","children":[]}]},{"type":"node","value":"publish_date","children":[{"type":"leaf","value":"2000-11-02","children":[]}]},{"type":"node","value":"description","children":[{"type":"leaf","value":"A deep sea diver finds true love twenty \n      thousand leagues beneath the sea.","children":[]}]}]},{"type":"node","value":"book","children":[{"type":"node","value":"author","children":[{"type":"leaf","value":"Knorr, Stefan","children":[]}]},{"type":"node","value":"title","children":[{"type":"leaf","value":"Creepy Crawlies","children":[]}]},{"type":"node","value":"genre","children":[{"type":"leaf","value":"Horror","children":[]}]},{"type":"node","value":"price","children":[{"type":"leaf","value":"4.95","children":[]}]},{"type":"node","value":"publish_date","children":[{"type":"leaf","value":"2000-12-06","children":[]}]},{"type":"node","value":"description","children":[{"type":"leaf","value":"An anthology of horror stories about roaches,\n      centipedes, scorpions  and other insects.","children":[]}]}]},{"type":"node","value":"book","children":[{"type":"node","value":"author","children":[{"type":"leaf","value":"Kress, Peter","children":[]}]},{"type":"node","value":"title","children":[{"type":"leaf","value":"Paradox Lost","children":[]}]},{"type":"node","value":"genre","children":[{"type":"leaf","value":"Science Fiction","children":[]}]},{"type":"node","value":"price","children":[{"type":"leaf","value":"6.95","children":[]}]},{"type":"node","value":"publish_date","children":[{"type":"leaf","value":"2000-11-02","children":[]}]},{"type":"node","value":"description","children":[{"type":"leaf","value":"After an inadvertant trip through a Heisenberg\n      Uncertainty Device, James Salway discovers the problems \n      of being quantum.","children":[]}]}]},{"type":"node","value":"book","children":[{"type":"node","value":"author","children":[{"type":"leaf","value":"O'Brien, Tim","children":[]}]},{"type":"node","value":"title","children":[{"type":"leaf","value":"Microsoft .NET: The Programming Bible","children":[]}]},{"type":"node","value":"genre","children":[{"type":"leaf","value":"Computer","children":[]}]},{"type":"node","value":"price","children":[{"type":"leaf","value":"36.95","children":[]}]},{"type":"node","value":"publish_date","children":[{"type":"leaf","value":"2000-12-09","children":[]}]},{"type":"node","value":"description","children":[{"type":"leaf","value":"Microsoft's .NET initiative is explored in \n      detail in this deep programmer's reference.","children":[]}]}]},{"type":"node","value":"book","children":[{"type":"node","value":"author","children":[{"type":"leaf","value":"O'Brien, Tim","children":[]}]},{"type":"node","value":"title","children":[{"type":"leaf","value":"MSXML3: A Comprehensive Guide","children":[]}]},{"type":"node","value":"genre","children":[{"type":"leaf","value":"Computer","children":[]}]},{"type":"node","value":"price","children":[{"type":"leaf","value":"36.95","children":[]}]},{"type":"node","value":"publish_date","children":[{"type":"leaf","value":"2000-12-01","children":[]}]},{"type":"node","value":"description","children":[{"type":"leaf","value":"The Microsoft MSXML3 parser is covered in \n      detail, with attention to XML DOM interfaces, XSLT processing, \n      SAX and more.","children":[]}]}]},{"type":"node","value":"book","children":[{"type":"node","value":"author","children":[{"type":"leaf","value":"Galos, Mike","children":[]}]},{"type":"node","value":"title","children":[{"type":"leaf","value":"Visual Studio 7: A Comprehensive Guide","children":[]}]},{"type":"node","value":"genre","children":[{"type":"leaf","value":"Computer","children":[]}]},{"type":"node","value":"price","children":[{"type":"leaf","value":"49.95","children":[]}]},{"type":"node","value":"publish_date","children":[{"type":"leaf","value":"2001-04-16","children":[]}]},{"type":"node","value":"description","children":[{"type":"leaf","value":"Microsoft Visual Studio 7 is explored in depth,\n      looking at how Visual Basic, Visual C++, C#, and ASP+ are \n      integrated into a comprehensive development \n      environment.","children":[]}]}]}]}

var maxlevel = 0;

// Root element
$("body").append(
    "<div class='level' id='level-0'> \
        <span class='group'> \
            <span class='" + input.type + "'>" + input.value + "</span> \
        </span> \
    </div>"
);

var draw = function (children, level) {

    // Add level to DOM
    if (level > maxlevel) {
        $("body").append("<div class='level' id='level-" + level + "'></div>");
        maxlevel = level;
    }

    // Add children to DOM
    var $group = $("<span class='group'></span>");
    $group.appendTo("#level-" + level);
    var left, right;
    for (var i = 0, len = children.length; i < len; i++) {
        var element = children[i];
        var $element = $("<span class='" + element.type + "'>" + element.value + "</span>");
        $element.appendTo($group);

        var width = $element[0].clientWidth;
        var center;

        if (element.type === "node") {
            center = draw(element.children, level + 1)
            $element.css("left", center - width / 2);
        } else {
            var bounds = $element[0].getBoundingClientRect();
            center = (bounds.left + bounds.right) / 2;
        }

        if (i === 0) {
            left = center - width / 2;
        }
        if (i === len - 1) {
            right = center + width / 2;
        }
    }
    
    // Return coordinates of the center of the group
    return (left + right) / 2;
};

var $element = $("#level-0 span");
var x = draw(input.children, 1) - $element[0].clientWidth / 2;
$element.css("left", x);

